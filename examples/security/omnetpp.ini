#
# omnetpp.ini - Security Benchmark Configuration
#
# CS 6376 Final Project - Resilient V2V ACC Defense
# Vanderbilt University - Preston Horne
#
# FDI attacks sourced from peer-reviewed CACC security literature:
#   [1] van der Heijden et al., "Analyzing Attacks on Cooperative Adaptive
#       Cruise Control (CACC)", IEEE VNC 2017, pp. 45-52
#   [2] Amoozadeh et al., "Security vulnerabilities of connected vehicle
#       streams and their impact on cooperative driving", IEEE CommMag 2015
#   [3] SAE J2735, "Dedicated Short Range Communications (DSRC) Message Set Dictionary"
#   [4] ETSI TS 103 097, "Intelligent Transport Systems Security"
#   [5] Boddupalli et al., "REPLACE: Real-time security assurance in vehicular
#       platoons against V2V attacks", IEEE ITSC 2021
#

[General]
cmdenv-express-mode = true
cmdenv-autoflush = true
cmdenv-status-frequency = 10s
num-rngs = 6

network = Security

##########################################################
#            Simulation parameters                       #
##########################################################
debug-on-errors = true
print-undisposed = true

*.playgroundSizeX = 65000m
*.playgroundSizeY = 25000m
*.playgroundSizeZ = 50m

sim-time-limit = 120s

##########################################################
# Annotation parameters                                  #
##########################################################
*.annotations.draw = false

##########################################################
# Obstacle parameters                                    #
##########################################################
*.obstacles.debug = false

##########################################################
#            WorldUtility parameters                     #
##########################################################
*.world.useTorus = false
*.world.use2D = false

##########################################################
#            TraCIScenarioManager parameters             #
##########################################################
*.manager.updateInterval = 0.01s
*.manager.host = "localhost"
*.manager.moduleType = "org.car2x.plexe.PlatoonCar"
*.manager.moduleName = "node"
*.manager.moduleDisplayString = ""
*.manager.autoShutdown = true
*.manager.margin = 25
*.manager.command = "sumo"
*.manager.ignoreGuiCommands = true

#launch config
*.manager.configFile = "./sumocfg/freeway.sumo.cfg"
*.manager.launchConfig = xmldoc("./sumocfg/freeway.launchd.xml")

##########################################################
#            11p specific parameters                     #
##########################################################
*.connectionManager.sendDirect = true
*.connectionManager.maxInterfDist = 2600m
*.connectionManager.drawMaxIntfDist = false

*.**.nic.mac1609_4.useServiceChannel = false
*.**.nic.mac1609_4.txPower = 100mW
*.**.nic.mac1609_4.bitrate = 6Mbps
*.**.nic.mac1609_4.useAcks = true
*.**.nic.mac1609_4.ackErrorRate = 0.0
*.**.nic.mac1609_4.frameErrorRate = 0.0

*.**.nic.phy80211p.minPowerLevel = -94dBm
*.**.nic.phy80211p.maxTXPower = 100mW
*.**.nic.phy80211p.useNoiseFloor = true
*.**.nic.phy80211p.noiseFloor = -95dBm
*.**.nic.phy80211p.decider = xmldoc("config.xml")
*.**.nic.phy80211p.analogueModels = xmldoc("config.xml")
*.**.nic.phy80211p.usePropagationDelay = true

##########################################################
#                      Mobility                          #
##########################################################
*.node[*].mobility.x = 0
*.node[*].mobility.y = 0
*.node[*].mobility.z = 1.895

##########################################################
#                    Seeds and PRNGs                     #
##########################################################
seed-set = ${repetition}
**.seed = ${repetition}

*.node[*].prot.rng-0 = 2
*.node[*].appl.rng-0 = 3
*.node[*].scenario.rng-0 = 4
**.traffic.rng-0 = 5

##########################################################
#                   Common parameters                    #
##########################################################

**.numberOfCars = ${nCars = 8}
**.numberOfCarsPerPlatoon = ${platoonSize = 8}
**.numberOfLanes = ${nLanes = 1}

##########################################################
#                    Position helper                     #
##########################################################

*.node[*].helper_type = "PositionHelper"

##########################################################
#               Scenario common parameters               #
##########################################################

#use CACC controller for security testing
*.node[*].scenario.caccC1 = 0.5
*.node[*].scenario.caccXi = 1
*.node[*].scenario.caccOmegaN = 0.2 Hz
*.node[*].scenario.caccSpacing = 5 m
*.node[*].scenario.engineTau = 0.5 s
*.node[*].scenario.ploegH = 0.5s
*.node[*].scenario.ploegKp = 0.2
*.node[*].scenario.ploegKd = 0.7
*.node[*].scenario.useRealisticEngine = false
*.node[*].scenario.useControllerAcceleration = true
*.node[*].scenario.nLanes = ${nLanes}

#use CACC controller
**.numericController = 2
**.headway = 0.1s
*.node[*].scenario.accHeadway = 0.1s
*.node[*].scenario.leaderHeadway = 1.2s
*.node[*].scenario.leaderSpeed = 100kmph

##########################################################
#                      Application                       #
##########################################################

*.node[*].appl_type = "SimplePlatooningApp"
*.node[*].appl.*.scalar-recording = true
*.node[*].appl.*.vector-recording = true

*.node[*].numPlexeApps = 1
*.node[*].plexeApp[0].typename = "HelloPlexeApp"
*.node[*].plexeApp[0].interfaceToUse = "VEINS_11P"

##########################################################
#           Secure Communication Protocol                #
##########################################################

# Use SecureCACCProtocol instead of SimplePlatooningBeaconing
*.node[*].protocol_type = "org.car2x.plexe.security.SecureCACCProtocol"

*.node[*].prot.*.scalar-recording = true
*.node[*].prot.*.vector-recording = true
*.node[*].prot.beaconingInterval = 0.1s
*.node[*].prot.priority = 4
*.node[*].prot.packetSize = 200

# Default defense thresholds (paper Section IV-B)
*.node[*].prot.positionThreshold = 5.0      # Paper: 5m position threshold
*.node[*].prot.speedThreshold = 3.0         # Paper Eq. 10: tau_th = 3 m/s
*.node[*].prot.accelThreshold = 4.0         # Paper: 4 m/s^2 acceleration threshold
*.node[*].prot.kalmanThreshold = 7.815      # Paper Eq. 11: chi^2(3, 0.05) = 7.815
*.node[*].prot.cusumThreshold = 5.0         # Paper Eq. 14: h = 5
*.node[*].prot.cusumDrift = 2.0             # Paper Eq. 13: delta = 2 m/s (Van der Heijden literature)
*.node[*].prot.hedgingAlpha = 0.5           # Paper Section IV-A: 50/50 blend
*.node[*].prot.radarNoise = 0.5             # Radar noise std dev sigma=0.5 m/s (Van der Heijden 2017)

# By default, attacks are disabled
*.node[*].prot.attackerEnabled = false

##########################################################
#                    Traffic manager                     #
##########################################################

**.traffic_type = "PlatoonsTrafficManager"
**.traffic.platoonInsertTime = 1 s
**.traffic.platoonInsertSpeed = 100kmph
**.traffic.nCars = ${nCars}
**.traffic.platoonSize = ${platoonSize}
**.traffic.nLanes = ${nLanes}
**.traffic.platooningVType = "vtypeauto"
**.traffic.controller = "CACC"
**.traffic.platoonInsertDistance = 5m
**.traffic.platoonInsertHeadway = 0s
**.traffic.platoonLeaderHeadway = 1.2s

#disable statistics for non-essential modules
**.scalar-recording = false
**.vector-recording = false

##########################################################
#                                                        #
#                 BENCHMARK CONFIGURATIONS               #
#                                                        #
##########################################################

#=========================================================
# Baseline: No attack, defense active
#=========================================================
[Config Baseline]
description = "Baseline CACC without attacks"
*.node[*].scenario_type = "SimpleScenario"
*.node[*].prot.attackerEnabled = false

output-vector-file = ${resultdir}/${configname}_${repetition}.vec
output-scalar-file = ${resultdir}/${configname}_${repetition}.sca

#=========================================================
# PRIMARY BENCHMARK
#
# All 8 standard FDI attacks from CACC security literature:
#
# SPEED FIELD ATTACKS:
#   constant:       van der Heijden VNC 2017 - report 0 m/s (stopped)
#   offset:         van der Heijden VNC 2017, Table I: 150 m/s offset
#   drift:          Amoozadeh IEEE CommMag 2015 - 2 m/s per second ramp
#   replay:         SAE J2735, ETSI ITS-G5 - 3 second delay
#   noise:          REPLACE taxonomy - 10x amplification
#
# ACCELERATION FIELD ATTACKS:
#   accel_offset:   van der Heijden VNC 2017, Table I: -30 m/s^2
#   accel_constant: Amoozadeh IEEE CommMag 2015: 6 m/s^2 constant
#
# POSITION FIELD ATTACKS:
#   position_shift: van der Heijden VNC 2017, Table I: 7 m/s shift rate
#
# Simulation setup matches van der Heijden VNC 2017:
#   - 8-vehicle platoon
#   - Ploeg CACC controller (h=0.5s)
#   - 10 Hz beacon interval
#   - Attack injected at t=30s
#   - Leader speed: 50 m/s (180 km/h)
#=========================================================

[Config PrimaryBenchmark]
description = "Literature FDI benchmark: all 8 standard attacks"
*.node[*].scenario_type = "SimpleScenario"

# Van der Heijden setup: leaderSpeed=50 m/s (180 km/h)
*.node[*].scenario.leaderSpeed = 180kmph
**.traffic.platoonInsertSpeed = 180kmph

*.node[1..7].prot.attackerEnabled = true

# All 8 literature-sourced FDI attacks with parameters from source papers:
#   constant:       van der Heijden - 0 m/s (report stopped)
#   offset:         van der Heijden Table I - 150 m/s
#   drift:          Amoozadeh - 2 m/s per second
#   replay:         SAE J2735 - 3 second delay
#   noise:          REPLACE - 10x multiplier
#   accel_offset:   van der Heijden Table I - -30 m/s^2
#   accel_constant: Amoozadeh - 6 m/s^2
#   position_shift: van der Heijden Table I - 7 m/s
*.node[1..7].prot.attackType = ${attackType="constant", "offset", "drift", "replay", "noise", "accel_offset", "accel_constant", "position_shift"}
*.node[1..7].prot.attackMagnitude = ${magnitude=0.0, 150.0, 2.0, 3.0, 10.0, -30.0, 6.0, 7.0 ! attackType}
*.node[1..7].prot.attackStartTime = 30.0    # Van der Heijden: attackStart=30
*.node[1..7].prot.attackDuration = 40.0

output-vector-file = ${resultdir}/${configname}_${attackType}_${repetition}.vec
output-scalar-file = ${resultdir}/${configname}_${attackType}_${repetition}.sca

#=========================================================
# SINGLE-ATTACKER BENCHMARK
#
# Per van der Heijden VNC 2017: single compromised vehicle scenario
# This matches the original paper's experimental setup more closely.
#
# Attacker position: Vehicle 3 (middle of platoon)
# - Vehicle 0: Leader (broadcasts reference)
# - Vehicle 1-2: Honest followers
# - Vehicle 3: ATTACKER (compromised)
# - Vehicle 4-7: Honest followers (victims)
#
# This configuration tests:
# 1. Detection capability with single malicious node
# 2. Impact propagation through platoon
# 3. Isolation of attack effects
#=========================================================

[Config SingleAttacker]
description = "Single-attacker FDI benchmark (van der Heijden setup)"
*.node[*].scenario_type = "SimpleScenario"

# Van der Heijden setup: leaderSpeed=50 m/s (180 km/h)
*.node[*].scenario.leaderSpeed = 180kmph
**.traffic.platoonInsertSpeed = 180kmph

# Only vehicle 3 is the attacker (middle of 8-vehicle platoon)
*.node[*].prot.attackerEnabled = false
*.node[3].prot.attackerEnabled = true

# All 8 literature-sourced FDI attacks
*.node[3].prot.attackType = ${attackType="constant", "offset", "drift", "replay", "noise", "accel_offset", "accel_constant", "position_shift"}
*.node[3].prot.attackMagnitude = ${magnitude=0.0, 150.0, 2.0, 3.0, 10.0, -30.0, 6.0, 7.0 ! attackType}
*.node[3].prot.attackStartTime = 30.0
*.node[3].prot.attackDuration = 40.0

output-vector-file = ${resultdir}/${configname}_${attackType}_${repetition}.vec
output-scalar-file = ${resultdir}/${configname}_${attackType}_${repetition}.sca

#=========================================================
# ATTACKER POSITION SWEEP
#
# Tests impact of attacker position in platoon:
# - Front attacker (vehicle 1): affects all followers
# - Middle attacker (vehicle 3): affects rear half
# - Rear attacker (vehicle 6): minimal propagation
#
# Per van der Heijden: "position in platoon affects attack impact"
#=========================================================

[Config AttackerPositionSweep]
description = "Attack impact vs. attacker position in platoon"
*.node[*].scenario_type = "SimpleScenario"

*.node[*].scenario.leaderSpeed = 180kmph
**.traffic.platoonInsertSpeed = 180kmph

# Sweep attacker position: front (1), middle (3), rear (6)
*.node[*].prot.attackerEnabled = false
*.node[${attackerPos=1, 3, 6}].prot.attackerEnabled = true

# Use offset attack (most impactful per van der Heijden Table II)
*.node[${attackerPos}].prot.attackType = "offset"
*.node[${attackerPos}].prot.attackMagnitude = 150.0
*.node[${attackerPos}].prot.attackStartTime = 30.0
*.node[${attackerPos}].prot.attackDuration = 40.0

output-vector-file = ${resultdir}/${configname}_pos${attackerPos}_${repetition}.vec
output-scalar-file = ${resultdir}/${configname}_pos${attackerPos}_${repetition}.sca

#=========================================================
# ATTACK MAGNITUDE SWEEP
#
# Per van der Heijden VNC 2017 Table I:
# Tests detection threshold sensitivity across attack magnitudes
#
# Speed offset: 50, 100, 150 m/s (van der Heijden)
# Accel offset: -30, -10, 0, 10, 30 m/sÂ² (van der Heijden)
# Position shift: 3, 5, 7, 9, 11 m/s (van der Heijden)
#=========================================================

[Config OffsetMagnitudeSweep]
description = "Speed offset attack magnitude sweep (van der Heijden Table I)"
*.node[*].scenario_type = "SimpleScenario"

*.node[*].scenario.leaderSpeed = 180kmph
**.traffic.platoonInsertSpeed = 180kmph

*.node[*].prot.attackerEnabled = false
*.node[3].prot.attackerEnabled = true
*.node[3].prot.attackType = "offset"
*.node[3].prot.attackMagnitude = ${offsetMag=50.0, 100.0, 150.0}
*.node[3].prot.attackStartTime = 30.0
*.node[3].prot.attackDuration = 40.0

output-vector-file = ${resultdir}/${configname}_mag${offsetMag}_${repetition}.vec
output-scalar-file = ${resultdir}/${configname}_mag${offsetMag}_${repetition}.sca

[Config AccelOffsetMagnitudeSweep]
description = "Accel offset attack magnitude sweep (van der Heijden Table I)"
*.node[*].scenario_type = "SimpleScenario"

*.node[*].scenario.leaderSpeed = 180kmph
**.traffic.platoonInsertSpeed = 180kmph

*.node[*].prot.attackerEnabled = false
*.node[3].prot.attackerEnabled = true
*.node[3].prot.attackType = "accel_offset"
*.node[3].prot.attackMagnitude = ${accelMag=-30.0, -10.0, 10.0, 30.0}
*.node[3].prot.attackStartTime = 30.0
*.node[3].prot.attackDuration = 40.0

output-vector-file = ${resultdir}/${configname}_mag${accelMag}_${repetition}.vec
output-scalar-file = ${resultdir}/${configname}_mag${accelMag}_${repetition}.sca

[Config PositionShiftMagnitudeSweep]
description = "Position shift attack magnitude sweep (van der Heijden Table I)"
*.node[*].scenario_type = "SimpleScenario"

*.node[*].scenario.leaderSpeed = 180kmph
**.traffic.platoonInsertSpeed = 180kmph

*.node[*].prot.attackerEnabled = false
*.node[3].prot.attackerEnabled = true
*.node[3].prot.attackType = "position_shift"
*.node[3].prot.attackMagnitude = ${posMag=3.0, 5.0, 7.0, 9.0, 11.0}
*.node[3].prot.attackStartTime = 30.0
*.node[3].prot.attackDuration = 40.0

output-vector-file = ${resultdir}/${configname}_mag${posMag}_${repetition}.vec
output-scalar-file = ${resultdir}/${configname}_mag${posMag}_${repetition}.sca

#=========================================================
# UNDEFENDED BENCHMARK
#
# Same as PrimaryBenchmark but with defense DISABLED.
# This provides the baseline for attack mitigation comparison.
#
# Used to compute:
#   Attack Mitigation = 1 - (impact_defended / impact_undefended)
#=========================================================

[Config UndefendedBenchmark]
description = "Undefended FDI benchmark: attacks without defense (for comparison)"
*.node[*].scenario_type = "SimpleScenario"

# Van der Heijden setup: leaderSpeed=50 m/s (180 km/h)
*.node[*].scenario.leaderSpeed = 180kmph
**.traffic.platoonInsertSpeed = 180kmph

# DEFENSE DISABLED - this is the key difference
*.node[*].prot.defenseEnabled = false

*.node[1..7].prot.attackerEnabled = true

# All 8 literature-sourced FDI attacks
*.node[1..7].prot.attackType = ${attackType="constant", "offset", "drift", "replay", "noise", "accel_offset", "accel_constant", "position_shift"}
*.node[1..7].prot.attackMagnitude = ${magnitude=0.0, 150.0, 2.0, 3.0, 10.0, -30.0, 6.0, 7.0 ! attackType}
*.node[1..7].prot.attackStartTime = 30.0
*.node[1..7].prot.attackDuration = 40.0

output-vector-file = ${resultdir}/${configname}_${attackType}_${repetition}.vec
output-scalar-file = ${resultdir}/${configname}_${attackType}_${repetition}.sca
